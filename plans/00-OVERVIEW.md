# HarvestIQ Project Overview

## What is HarvestIQ?

Multi-tenant SaaS construction project management platform with AI-powered insights and capital risk intelligence. Track schedules, budgets, documents, payments, task items, and reminders across multiple projects with conversational AI for querying data and predictive analytics for property valuations.

## Core Purpose

Help construction developers:
- Manage multiple projects simultaneously
- Track schedules from overall project down to individual tasks
- Maintain itemized budgets and track spending
- Upload and organize documents (invoices, estimates, contracts)
- Track payments, invoices, and outstanding balances
- Manage task items and reminders with notifications
- Query data naturally using AI conversation
- Learn from project data to build more efficiently
- Monitor capital exposure and risk across the portfolio
- Generate AI-powered ARV predictions using market data

## SaaS Model

- Multi-tenant architecture with builder-level isolation
- Builders (subscribers) as top-level tenants
- Each builder has organizations, users, and projects
- Subscription-based access (free, pro, enterprise tiers)
- Storage quotas per builder

## Users

- Multi-user team access within each builder
- Role-based permissions (Admin, Manager, Member, Viewer)
- Email and in-app notifications

## Tech Stack

| Layer | Technology |
|-------|------------|
| Frontend | Next.js 15, React 19, TypeScript, Tailwind CSS |
| Backend | Express 5, TypeScript |
| Database | PostgreSQL (Railway) with pgvector |
| File Storage | Cloudflare R2 |
| Hosting | Vercel (frontend), Railway (backend) |
| Notifications | Resend (email), In-app |
| AI | Claude API, OpenAI embeddings |
| Market Data | FRED API (Federal Reserve Economic Data) |
| Job Queue | pg-boss (PostgreSQL-based) |

## Implementation Phases

| Phase | Focus | Status |
|-------|-------|--------|
| 1 | Infrastructure & Authentication | Complete |
| 2 | Core Data Models | Complete |
| 3 | Schedule & Budget | Complete |
| 4 | Documents & Payments | Complete |
| 5 | Tasks & Notifications | Complete |
| 6 | Dashboard & Reports | Complete |
| 7 | AI Integration | Complete |
| 8 | Capital Risk Intelligence | Complete |

## Phase Documents

- [01-INFRASTRUCTURE.md](./01-INFRASTRUCTURE.md) - Auth, teams, jobs, storage setup
- [02-DATA-MODELS.md](./02-DATA-MODELS.md) - Database schemas and API endpoints
- [03-FEATURES.md](./03-FEATURES.md) - User-facing functionality
- [04-AI-INTEGRATION.md](./04-AI-INTEGRATION.md) - Conversational AI layer
- [05-SECURITY.md](./05-SECURITY.md) - Security architecture and audit plan
- [06-API-SPECIFICATION.md](./06-API-SPECIFICATION.md) - API specifications
- [07-IMPLEMENTATION-PHASES.md](./07-IMPLEMENTATION-PHASES.md) - Phase details

## Phase 8 Details: Capital Risk Intelligence

Phase 8 introduces proactive risk management and predictive analytics:

### Capital Exposure Dashboard
- Portfolio-wide capital at risk summary
- Risk distribution by severity (Critical, High, Medium, Low)
- Project risk overview table with composite scores
- Required interventions panel with ranked action items

### Risk Calculation System
- **Schedule Risk (0-100):** Overdue tasks, blocked tasks, phase delays, milestone slippage
- **Budget Risk (0-100):** Variance, over-budget categories, burn rate deviation, cost per unit
- **Composite Score:** Weighted combination with trend modifiers
- **Risk Levels:** Critical (>=75), High (>=50), Medium (>=25), Low (<25)

### Predictive ARV (After Repair Value)
- AI-powered prediction using Claude API
- Market data integration via FRED API (Housing Price Index)
- State-level and national appreciation rates
- Confidence scoring (low/medium/high with percentage)
- Reasoning and factor breakdown
- Compare predicted ARV to target ARV

### Industry Benchmarks
- Phase duration benchmarks by unit type
- Budget category percentages from NAHB/RSMeans standards
- Builder-specific learned benchmarks from completed projects

### Required Interventions
- Automatically generated from risk analysis
- Severity levels with color coding
- Capital and schedule impact estimates
- One-click acknowledgment workflow

## Implementation Order

Back to front:
1. Database tables and migrations
2. API endpoints
3. Frontend pages

## Key Architectural Decisions

### Multi-Tenancy
- Every table includes `builder_id` for tenant isolation
- JWT tokens include `builder_id` in payload
- All queries filter by builder context first

### Background Processing
- Job queue for async operations
- Scheduled notifications via background workers
- Document text extraction and embedding generation

### AI Integration
- Conversation history persisted in database
- Document embeddings for semantic search (pgvector)
- Learned patterns stored for baseline comparisons
- Proactive insights generated by background jobs

### Capital Risk
- Risk metrics recalculated on demand or scheduled
- Interventions regenerated on each calculation
- Market data cached for efficiency
- Predictive models use current + market data
