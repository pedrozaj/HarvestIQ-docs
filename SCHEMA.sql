-- =============================================================================
-- HarvestIQ Database Schema
-- Generated: 2026-01-11 05:11:03 UTC
-- Source: Production PostgreSQL database via pg_dump
-- 
-- DO NOT EDIT MANUALLY
-- This file is auto-generated by: scripts/generate-schema.sh
-- =============================================================================

--
-- PostgreSQL database dump
--

\restrict rUCRxK0nmk6tgoHhi6nzvsKy8gXCDX9cm0qFHsgAPFu4v1Urq29oy9kgN5uBKWj

-- Dumped from database version 17.7 (Debian 17.7-3.pgdg13+1)
-- Dumped by pg_dump version 18.1

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: pgboss; Type: SCHEMA; Schema: -; Owner: -
--

CREATE SCHEMA pgboss;


--
-- Name: job_state; Type: TYPE; Schema: pgboss; Owner: -
--

CREATE TYPE pgboss.job_state AS ENUM (
    'created',
    'retry',
    'active',
    'completed',
    'cancelled',
    'failed'
);


--
-- Name: create_queue(text, jsonb); Type: FUNCTION; Schema: pgboss; Owner: -
--

CREATE FUNCTION pgboss.create_queue(queue_name text, options jsonb) RETURNS void
    LANGUAGE plpgsql
    AS $_$
    DECLARE
      tablename varchar := CASE WHEN options->>'partition' = 'true'
                            THEN 'j' || encode(sha224(queue_name::bytea), 'hex')
                            ELSE 'job_common'
                            END;
      queue_created_on timestamptz;
    BEGIN

      WITH q as (
        INSERT INTO pgboss.queue (
          name,
          policy,
          retry_limit,
          retry_delay,
          retry_backoff,
          retry_delay_max,
          expire_seconds,
          retention_seconds,
          deletion_seconds,
          warning_queued,
          dead_letter,
          partition,
          table_name
        )
        VALUES (
          queue_name,
          options->>'policy',
          COALESCE((options->>'retryLimit')::int, 2),
          COALESCE((options->>'retryDelay')::int, 0),
          COALESCE((options->>'retryBackoff')::bool, false),
          (options->>'retryDelayMax')::int,
          COALESCE((options->>'expireInSeconds')::int, 900),
          COALESCE((options->>'retentionSeconds')::int, 1209600),
          COALESCE((options->>'deleteAfterSeconds')::int, 604800),
          COALESCE((options->>'warningQueueSize')::int, 0),
          options->>'deadLetter',
          COALESCE((options->>'partition')::bool, false),
          tablename
        )
        ON CONFLICT DO NOTHING
        RETURNING created_on
      )
      SELECT created_on into queue_created_on from q;

      IF queue_created_on IS NULL OR options->>'partition' IS DISTINCT FROM 'true' THEN
        RETURN;
      END IF;

      EXECUTE format('CREATE TABLE pgboss.%I (LIKE pgboss.job INCLUDING DEFAULTS)', tablename);
      
      EXECUTE format('ALTER TABLE pgboss.%1$I ADD PRIMARY KEY (name, id)', tablename);
      EXECUTE format('ALTER TABLE pgboss.%1$I ADD CONSTRAINT q_fkey FOREIGN KEY (name) REFERENCES pgboss.queue (name) ON DELETE RESTRICT DEFERRABLE INITIALLY DEFERRED', tablename);
      EXECUTE format('ALTER TABLE pgboss.%1$I ADD CONSTRAINT dlq_fkey FOREIGN KEY (dead_letter) REFERENCES pgboss.queue (name) ON DELETE RESTRICT DEFERRABLE INITIALLY DEFERRED', tablename);

      EXECUTE format('CREATE INDEX %1$s_i5 ON pgboss.%1$I (name, start_after) INCLUDE (priority, created_on, id) WHERE state < ''active''', tablename);
      EXECUTE format('CREATE UNIQUE INDEX %1$s_i4 ON pgboss.%1$I (name, singleton_on, COALESCE(singleton_key, '''')) WHERE state <> ''cancelled'' AND singleton_on IS NOT NULL', tablename);
      
      IF options->>'policy' = 'short' THEN
        EXECUTE format('CREATE UNIQUE INDEX %1$s_i1 ON pgboss.%1$I (name, COALESCE(singleton_key, '''')) WHERE state = ''created'' AND policy = ''short''', tablename);
      ELSIF options->>'policy' = 'singleton' THEN
        EXECUTE format('CREATE UNIQUE INDEX %1$s_i2 ON pgboss.%1$I (name, COALESCE(singleton_key, '''')) WHERE state = ''active'' AND policy = ''singleton''', tablename);
      ELSIF options->>'policy' = 'stately' THEN
        EXECUTE format('CREATE UNIQUE INDEX %1$s_i3 ON pgboss.%1$I (name, state, COALESCE(singleton_key, '''')) WHERE state <= ''active'' AND policy = ''stately''', tablename);
      ELSIF options->>'policy' = 'exclusive' THEN
        EXECUTE format('CREATE UNIQUE INDEX %1$s_i6 ON pgboss.%1$I (name, COALESCE(singleton_key, '''')) WHERE state <= ''active'' AND policy = ''exclusive''', tablename);
      END IF;

      EXECUTE format('ALTER TABLE pgboss.%I ADD CONSTRAINT cjc CHECK (name=%L)', tablename, queue_name);
      EXECUTE format('ALTER TABLE pgboss.job ATTACH PARTITION pgboss.%I FOR VALUES IN (%L)', tablename, queue_name);
    END;
    $_$;


--
-- Name: delete_queue(text); Type: FUNCTION; Schema: pgboss; Owner: -
--

CREATE FUNCTION pgboss.delete_queue(queue_name text) RETURNS void
    LANGUAGE plpgsql
    AS $$
    DECLARE
      v_table varchar;
      v_partition bool;
    BEGIN
      SELECT table_name, partition
      FROM pgboss.queue
      WHERE name = queue_name
      INTO v_table, v_partition;

      IF v_partition THEN
        EXECUTE format('DROP TABLE IF EXISTS pgboss.%I', v_table);
      ELSE
        EXECUTE format('DELETE FROM pgboss.%I WHERE name = %L', v_table, queue_name);
      END IF;

      DELETE FROM pgboss.queue WHERE name = queue_name;
    END;
    $$;


--
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: public; Owner: -
--

CREATE FUNCTION public.update_updated_at_column() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$;


SET default_tablespace = '';

--
-- Name: job; Type: TABLE; Schema: pgboss; Owner: -
--

CREATE TABLE pgboss.job (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    priority integer DEFAULT 0 NOT NULL,
    data jsonb,
    state pgboss.job_state DEFAULT 'created'::pgboss.job_state NOT NULL,
    retry_limit integer DEFAULT 2 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_delay integer DEFAULT 0 NOT NULL,
    retry_backoff boolean DEFAULT false NOT NULL,
    retry_delay_max integer,
    expire_seconds integer DEFAULT 900 NOT NULL,
    deletion_seconds integer DEFAULT 604800 NOT NULL,
    singleton_key text,
    singleton_on timestamp without time zone,
    start_after timestamp with time zone DEFAULT now() NOT NULL,
    created_on timestamp with time zone DEFAULT now() NOT NULL,
    started_on timestamp with time zone,
    completed_on timestamp with time zone,
    keep_until timestamp with time zone DEFAULT (now() + '336:00:00'::interval) NOT NULL,
    output jsonb,
    dead_letter text,
    policy text
)
PARTITION BY LIST (name);


SET default_table_access_method = heap;

--
-- Name: job_common; Type: TABLE; Schema: pgboss; Owner: -
--

CREATE TABLE pgboss.job_common (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL,
    priority integer DEFAULT 0 NOT NULL,
    data jsonb,
    state pgboss.job_state DEFAULT 'created'::pgboss.job_state NOT NULL,
    retry_limit integer DEFAULT 2 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_delay integer DEFAULT 0 NOT NULL,
    retry_backoff boolean DEFAULT false NOT NULL,
    retry_delay_max integer,
    expire_seconds integer DEFAULT 900 NOT NULL,
    deletion_seconds integer DEFAULT 604800 NOT NULL,
    singleton_key text,
    singleton_on timestamp without time zone,
    start_after timestamp with time zone DEFAULT now() NOT NULL,
    created_on timestamp with time zone DEFAULT now() NOT NULL,
    started_on timestamp with time zone,
    completed_on timestamp with time zone,
    keep_until timestamp with time zone DEFAULT (now() + '336:00:00'::interval) NOT NULL,
    output jsonb,
    dead_letter text,
    policy text
);


--
-- Name: queue; Type: TABLE; Schema: pgboss; Owner: -
--

CREATE TABLE pgboss.queue (
    name text NOT NULL,
    policy text NOT NULL,
    retry_limit integer NOT NULL,
    retry_delay integer NOT NULL,
    retry_backoff boolean NOT NULL,
    retry_delay_max integer,
    expire_seconds integer NOT NULL,
    retention_seconds integer NOT NULL,
    deletion_seconds integer NOT NULL,
    dead_letter text,
    partition boolean NOT NULL,
    table_name text NOT NULL,
    deferred_count integer DEFAULT 0 NOT NULL,
    queued_count integer DEFAULT 0 NOT NULL,
    warning_queued integer DEFAULT 0 NOT NULL,
    active_count integer DEFAULT 0 NOT NULL,
    total_count integer DEFAULT 0 NOT NULL,
    singletons_active text[],
    monitor_on timestamp with time zone,
    maintain_on timestamp with time zone,
    created_on timestamp with time zone DEFAULT now() NOT NULL,
    updated_on timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT queue_check CHECK ((dead_letter IS DISTINCT FROM name))
);


--
-- Name: schedule; Type: TABLE; Schema: pgboss; Owner: -
--

CREATE TABLE pgboss.schedule (
    name text NOT NULL,
    key text DEFAULT ''::text NOT NULL,
    cron text NOT NULL,
    timezone text,
    data jsonb,
    options jsonb,
    created_on timestamp with time zone DEFAULT now() NOT NULL,
    updated_on timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: subscription; Type: TABLE; Schema: pgboss; Owner: -
--

CREATE TABLE pgboss.subscription (
    event text NOT NULL,
    name text NOT NULL,
    created_on timestamp with time zone DEFAULT now() NOT NULL,
    updated_on timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: version; Type: TABLE; Schema: pgboss; Owner: -
--

CREATE TABLE pgboss.version (
    version integer NOT NULL,
    cron_on timestamp with time zone
);


--
-- Name: _migrations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public._migrations (
    id integer NOT NULL,
    name character varying(255) NOT NULL,
    executed_at timestamp with time zone DEFAULT now()
);


--
-- Name: _migrations_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public._migrations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: _migrations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public._migrations_id_seq OWNED BY public._migrations.id;


--
-- Name: activity_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.activity_log (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    user_id uuid,
    project_id uuid,
    entity_type character varying(50) NOT NULL,
    entity_id uuid NOT NULL,
    action character varying(50) NOT NULL,
    changes jsonb,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: ai_conversations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ai_conversations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    user_id uuid NOT NULL,
    project_id uuid,
    title character varying(255),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: ai_feedback; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ai_feedback (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    message_id uuid NOT NULL,
    user_id uuid NOT NULL,
    rating integer,
    feedback_text text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: ai_insights; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ai_insights (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid,
    insight_type character varying(50) NOT NULL,
    title character varying(255) NOT NULL,
    description text NOT NULL,
    data jsonb,
    severity character varying(20) DEFAULT 'info'::character varying NOT NULL,
    is_dismissed boolean DEFAULT false NOT NULL,
    dismissed_by uuid,
    dismissed_at timestamp with time zone,
    expires_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: ai_messages; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ai_messages (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    conversation_id uuid NOT NULL,
    role character varying(20) NOT NULL,
    content text NOT NULL,
    query_type character varying(50),
    query_params jsonb,
    sources jsonb,
    tokens_used integer,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: ai_patterns; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.ai_patterns (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    pattern_type character varying(50) NOT NULL,
    category_id uuid,
    pattern_data jsonb NOT NULL,
    confidence numeric(3,2),
    last_calculated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: alert_thresholds; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.alert_thresholds (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid,
    category_id uuid,
    threshold_type character varying(20) NOT NULL,
    threshold_value numeric(12,2) NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    last_triggered_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: budget_categories; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.budget_categories (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    name character varying(100) NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    group_name character varying(50) DEFAULT 'Vertical'::character varying,
    deleted_at timestamp with time zone
);


--
-- Name: budget_category_benchmarks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.budget_category_benchmarks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    unit_type character varying(50) NOT NULL,
    category_name character varying(100) NOT NULL,
    group_name character varying(50),
    min_percent numeric(5,2) NOT NULL,
    typical_percent numeric(5,2) NOT NULL,
    max_percent numeric(5,2) NOT NULL,
    cost_per_unit_min numeric(12,2),
    cost_per_unit_typical numeric(12,2),
    cost_per_unit_max numeric(12,2),
    source character varying(100) DEFAULT 'industry_standard'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: budget_items; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.budget_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    category_id uuid NOT NULL,
    phase_id uuid,
    name character varying(255) NOT NULL,
    description text,
    estimated_amount numeric(12,2) DEFAULT 0 NOT NULL,
    actual_amount numeric(12,2) DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    total_quantity integer DEFAULT 1 NOT NULL,
    completed_quantity integer DEFAULT 0 NOT NULL,
    is_purchased boolean DEFAULT false NOT NULL,
    CONSTRAINT completed_lte_total CHECK ((completed_quantity <= total_quantity))
);


--
-- Name: builder_benchmarks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.builder_benchmarks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    unit_type character varying(50) NOT NULL,
    phase_benchmarks jsonb,
    category_benchmarks jsonb,
    avg_duration_days numeric(10,2),
    avg_cost_per_unit numeric(12,2),
    avg_budget_variance_percent numeric(10,2),
    avg_duration_variance_percent numeric(10,2),
    sample_count integer DEFAULT 0 NOT NULL,
    confidence_level character varying(20) DEFAULT 'low'::character varying NOT NULL,
    blend_weight numeric(3,2) DEFAULT 0 NOT NULL,
    last_calculated_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: builders; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.builders (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    name character varying(255) NOT NULL,
    subscription_status character varying(50) DEFAULT 'trial'::character varying NOT NULL,
    subscription_plan character varying(50) DEFAULT 'free'::character varying NOT NULL,
    trial_ends_at timestamp with time zone,
    subscription_started_at timestamp with time zone,
    subscription_ends_at timestamp with time zone,
    billing_email character varying(255),
    storage_used_bytes bigint DEFAULT 0 NOT NULL,
    storage_limit_bytes bigint DEFAULT '5368709120'::bigint NOT NULL,
    ai_tokens_used_month integer DEFAULT 0 NOT NULL,
    ai_tokens_limit_month integer DEFAULT 100000 NOT NULL,
    ai_tokens_reset_at timestamp with time zone,
    settings jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    ai_tokens_limit integer DEFAULT 100000 NOT NULL
);


--
-- Name: contractors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.contractors (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    name character varying(255) NOT NULL,
    company character varying(255),
    specialty character varying(100),
    phone character varying(50),
    email character varying(255),
    address text,
    status character varying(50) DEFAULT 'available'::character varying,
    rating numeric(2,1) DEFAULT 0,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    deleted_at timestamp with time zone,
    CONSTRAINT contractors_rating_check CHECK (((rating >= (0)::numeric) AND (rating <= (5)::numeric))),
    CONSTRAINT contractors_status_check CHECK (((status)::text = ANY ((ARRAY['available'::character varying, 'on_project'::character varying, 'unavailable'::character varying])::text[])))
);


--
-- Name: document_embeddings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.document_embeddings (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    document_id uuid NOT NULL,
    chunk_index integer NOT NULL,
    chunk_text text NOT NULL,
    embedding jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: documents; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.documents (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    uploaded_by uuid NOT NULL,
    name character varying(255) NOT NULL,
    original_filename character varying(255) NOT NULL,
    storage_key character varying(500) NOT NULL,
    mime_type character varying(100) NOT NULL,
    size_bytes bigint NOT NULL,
    type character varying(50) DEFAULT 'other'::character varying NOT NULL,
    description text,
    tags text[] DEFAULT '{}'::text[],
    extracted_text text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb
);


--
-- Name: files; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.files (
    id integer NOT NULL,
    filename text NOT NULL,
    original_name text NOT NULL,
    mime_type text NOT NULL,
    size integer NOT NULL,
    storage_key text NOT NULL,
    project_id integer,
    uploaded_by integer,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: files_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.files_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: files_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.files_id_seq OWNED BY public.files.id;


--
-- Name: industry_benchmarks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.industry_benchmarks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    unit_type character varying(50) NOT NULL,
    phase_name character varying(100) NOT NULL,
    metric_type character varying(50) NOT NULL,
    min_value numeric(10,2) NOT NULL,
    typical_value numeric(10,2) NOT NULL,
    max_value numeric(10,2) NOT NULL,
    source character varying(100) DEFAULT 'industry_standard'::character varying,
    notes text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: invitations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invitations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    organization_id uuid NOT NULL,
    email character varying(255) NOT NULL,
    role character varying(50) DEFAULT 'member'::character varying NOT NULL,
    token character varying(255) NOT NULL,
    invited_by uuid NOT NULL,
    message text,
    expires_at timestamp with time zone NOT NULL,
    accepted_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: invoices; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.invoices (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    category_id uuid,
    document_id uuid,
    invoice_number character varying(100),
    description text,
    amount numeric(12,2) NOT NULL,
    paid_amount numeric(12,2) DEFAULT 0 NOT NULL,
    status character varying(50) DEFAULT 'unpaid'::character varying NOT NULL,
    invoice_date date,
    due_date date,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    budget_item_id uuid
);


--
-- Name: notification_deliveries; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_deliveries (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    notification_id uuid NOT NULL,
    channel character varying(20) NOT NULL,
    status character varying(20) DEFAULT 'pending'::character varying NOT NULL,
    attempts integer DEFAULT 0 NOT NULL,
    max_attempts integer DEFAULT 3 NOT NULL,
    last_attempt_at timestamp with time zone,
    sent_at timestamp with time zone,
    error_message text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: notification_preferences; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notification_preferences (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    user_id uuid NOT NULL,
    notification_type character varying(50) NOT NULL,
    email_enabled boolean DEFAULT true NOT NULL,
    sms_enabled boolean DEFAULT false NOT NULL,
    in_app_enabled boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: notifications; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.notifications (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    user_id uuid NOT NULL,
    type character varying(50) NOT NULL,
    title character varying(255) NOT NULL,
    message text NOT NULL,
    data jsonb,
    is_read boolean DEFAULT false NOT NULL,
    read_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: organization_members; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.organization_members (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    organization_id uuid NOT NULL,
    user_id uuid NOT NULL,
    role character varying(50) DEFAULT 'member'::character varying NOT NULL,
    invited_at timestamp with time zone DEFAULT now() NOT NULL,
    joined_at timestamp with time zone,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: organizations; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.organizations (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    name character varying(255) NOT NULL,
    is_default boolean DEFAULT false NOT NULL,
    settings jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: payments; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.payments (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    invoice_id uuid,
    category_id uuid,
    amount numeric(12,2) NOT NULL,
    payment_date date NOT NULL,
    payment_method character varying(50),
    reference_number character varying(100),
    description text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: project_contractors; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.project_contractors (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    contractor_id uuid NOT NULL,
    assigned_at timestamp with time zone DEFAULT now(),
    assigned_by uuid,
    notes text,
    created_at timestamp with time zone DEFAULT now(),
    deleted_at timestamp with time zone
);


--
-- Name: project_outcomes; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.project_outcomes (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    unit_type character varying(50) NOT NULL,
    unit_count integer NOT NULL,
    planned_start_date date,
    planned_end_date date,
    actual_start_date date,
    actual_end_date date,
    planned_duration_days integer,
    actual_duration_days integer,
    duration_variance_days integer,
    duration_variance_percent numeric(10,2),
    total_estimated_budget numeric(14,2) NOT NULL,
    total_actual_cost numeric(14,2) NOT NULL,
    budget_variance numeric(14,2) NOT NULL,
    budget_variance_percent numeric(10,2) NOT NULL,
    final_cost_per_unit numeric(12,2),
    phase_outcomes jsonb,
    category_outcomes jsonb,
    change_order_count integer DEFAULT 0,
    change_order_total numeric(12,2) DEFAULT 0,
    completed_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: project_risk_metrics; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.project_risk_metrics (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    overdue_tasks_count integer DEFAULT 0 NOT NULL,
    blocked_tasks_count integer DEFAULT 0 NOT NULL,
    phase_delay_days integer DEFAULT 0 NOT NULL,
    milestone_slippage_days integer DEFAULT 0 NOT NULL,
    schedule_risk_score integer DEFAULT 0 NOT NULL,
    budget_variance_percent numeric(10,2) DEFAULT 0 NOT NULL,
    over_budget_categories_count integer DEFAULT 0 NOT NULL,
    burn_rate_deviation numeric(10,2) DEFAULT 0 NOT NULL,
    cost_per_unit_variance numeric(10,2) DEFAULT 0 NOT NULL,
    budget_risk_score integer DEFAULT 0 NOT NULL,
    composite_risk_score integer DEFAULT 0 NOT NULL,
    risk_level character varying(20) DEFAULT 'low'::character varying NOT NULL,
    capital_at_risk numeric(14,2) DEFAULT 0 NOT NULL,
    trend character varying(20) DEFAULT 'stable'::character varying NOT NULL,
    previous_composite_score integer,
    trend_velocity numeric(5,2) DEFAULT 0,
    calculated_at timestamp with time zone DEFAULT now() NOT NULL,
    calculation_version integer DEFAULT 1 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- Name: projects; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.projects (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    organization_id uuid NOT NULL,
    name character varying(255) NOT NULL,
    address text,
    unit_type character varying(50) NOT NULL,
    units integer NOT NULL,
    lot_size_acres numeric(10,2),
    status character varying(50) DEFAULT 'planning'::character varying NOT NULL,
    start_date date,
    end_date date,
    description text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    purchase_price numeric(14,2),
    appraised_value numeric(14,2),
    target_arv numeric(14,2),
    valuation_date date,
    appraisal_document_id uuid,
    predicted_arv numeric(14,2),
    material_inflation_rate numeric(5,4) DEFAULT 0.05 NOT NULL
);


--
-- Name: refresh_tokens; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.refresh_tokens (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    user_id uuid NOT NULL,
    token_hash character varying(255) NOT NULL,
    device_info character varying(500),
    expires_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    revoked_at timestamp with time zone,
    revoked_by uuid
);


--
-- Name: reminders; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.reminders (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    user_id uuid NOT NULL,
    project_id uuid,
    related_entity_type character varying(50),
    related_entity_id uuid,
    title character varying(255) NOT NULL,
    description text,
    remind_at timestamp with time zone NOT NULL,
    recurrence character varying(20) DEFAULT 'none'::character varying,
    is_dismissed boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: risk_interventions; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.risk_interventions (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    intervention_type character varying(50) NOT NULL,
    severity character varying(20) NOT NULL,
    priority_rank integer DEFAULT 0 NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    recommended_action text NOT NULL,
    entity_type character varying(50),
    entity_id uuid,
    entity_name character varying(255),
    capital_impact numeric(12,2) DEFAULT 0,
    days_impact integer DEFAULT 0,
    status character varying(30) DEFAULT 'active'::character varying NOT NULL,
    acknowledged_at timestamp with time zone,
    acknowledged_by uuid,
    resolved_at timestamp with time zone,
    expires_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: schedule_milestones; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.schedule_milestones (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    phase_id uuid,
    name character varying(255) NOT NULL,
    description text,
    target_date date NOT NULL,
    actual_date date,
    status character varying(50) DEFAULT 'upcoming'::character varying NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: schedule_phases; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.schedule_phases (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    sort_order integer DEFAULT 0 NOT NULL,
    status character varying(50) DEFAULT 'not_started'::character varying NOT NULL,
    start_date date,
    end_date date,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: schedule_tasks; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.schedule_tasks (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid NOT NULL,
    phase_id uuid NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    assigned_to uuid,
    status character varying(50) DEFAULT 'not_started'::character varying NOT NULL,
    priority character varying(20) DEFAULT 'medium'::character varying NOT NULL,
    planned_start_date date,
    planned_end_date date,
    actual_start_date date,
    actual_end_date date,
    estimated_hours numeric(10,2),
    actual_hours numeric(10,2),
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    total_quantity integer DEFAULT 1 NOT NULL,
    completed_quantity integer DEFAULT 0 NOT NULL,
    duration_days integer
);


--
-- Name: settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.settings (
    id integer NOT NULL,
    key text NOT NULL,
    value text NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP
);


--
-- Name: settings_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.settings_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- Name: settings_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.settings_id_seq OWNED BY public.settings.id;


--
-- Name: task_dependencies; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.task_dependencies (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    task_id uuid NOT NULL,
    depends_on_task_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    CONSTRAINT chk_no_self_dependency CHECK ((task_id <> depends_on_task_id))
);


--
-- Name: task_items; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.task_items (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    project_id uuid,
    schedule_task_id uuid,
    assigned_to uuid,
    created_by uuid NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    status character varying(50) DEFAULT 'pending'::character varying NOT NULL,
    priority character varying(20) DEFAULT 'medium'::character varying NOT NULL,
    due_date date,
    completed_at timestamp with time zone,
    completed_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: users; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.users (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    builder_id uuid NOT NULL,
    email character varying(255) NOT NULL,
    password_hash character varying(255) NOT NULL,
    name character varying(255) NOT NULL,
    phone character varying(50),
    timezone character varying(50) DEFAULT 'America/New_York'::character varying,
    notification_preferences jsonb DEFAULT '{"types": {"system": ["in_app"], "reminder": ["email", "in_app"], "task_due": ["email", "in_app"], "invoice_due": ["email"], "task_assigned": ["in_app"], "milestone_approaching": ["email", "in_app"]}, "channels": {"sms": false, "email": true, "in_app": true}}'::jsonb,
    email_verified_at timestamp with time zone,
    email_verification_token character varying(255),
    email_verification_expires_at timestamp with time zone,
    last_login_at timestamp with time zone,
    failed_login_attempts integer DEFAULT 0 NOT NULL,
    locked_until timestamp with time zone,
    password_reset_token character varying(255),
    password_reset_expires_at timestamp with time zone,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


--
-- Name: job_common; Type: TABLE ATTACH; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.job ATTACH PARTITION pgboss.job_common DEFAULT;


--
-- Name: _migrations id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public._migrations ALTER COLUMN id SET DEFAULT nextval('public._migrations_id_seq'::regclass);


--
-- Name: files id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.files ALTER COLUMN id SET DEFAULT nextval('public.files_id_seq'::regclass);


--
-- Name: settings id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settings ALTER COLUMN id SET DEFAULT nextval('public.settings_id_seq'::regclass);


--
-- Name: job job_pkey; Type: CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.job
    ADD CONSTRAINT job_pkey PRIMARY KEY (name, id);


--
-- Name: job_common job_common_pkey; Type: CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.job_common
    ADD CONSTRAINT job_common_pkey PRIMARY KEY (name, id);


--
-- Name: queue queue_pkey; Type: CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.queue
    ADD CONSTRAINT queue_pkey PRIMARY KEY (name);


--
-- Name: schedule schedule_pkey; Type: CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.schedule
    ADD CONSTRAINT schedule_pkey PRIMARY KEY (name, key);


--
-- Name: subscription subscription_pkey; Type: CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.subscription
    ADD CONSTRAINT subscription_pkey PRIMARY KEY (event, name);


--
-- Name: version version_pkey; Type: CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.version
    ADD CONSTRAINT version_pkey PRIMARY KEY (version);


--
-- Name: _migrations _migrations_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public._migrations
    ADD CONSTRAINT _migrations_name_key UNIQUE (name);


--
-- Name: _migrations _migrations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public._migrations
    ADD CONSTRAINT _migrations_pkey PRIMARY KEY (id);


--
-- Name: activity_log activity_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.activity_log
    ADD CONSTRAINT activity_log_pkey PRIMARY KEY (id);


--
-- Name: ai_conversations ai_conversations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_conversations
    ADD CONSTRAINT ai_conversations_pkey PRIMARY KEY (id);


--
-- Name: ai_feedback ai_feedback_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_feedback
    ADD CONSTRAINT ai_feedback_pkey PRIMARY KEY (id);


--
-- Name: ai_insights ai_insights_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_insights
    ADD CONSTRAINT ai_insights_pkey PRIMARY KEY (id);


--
-- Name: ai_messages ai_messages_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_messages
    ADD CONSTRAINT ai_messages_pkey PRIMARY KEY (id);


--
-- Name: ai_patterns ai_patterns_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_patterns
    ADD CONSTRAINT ai_patterns_pkey PRIMARY KEY (id);


--
-- Name: alert_thresholds alert_thresholds_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.alert_thresholds
    ADD CONSTRAINT alert_thresholds_pkey PRIMARY KEY (id);


--
-- Name: budget_categories budget_categories_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_categories
    ADD CONSTRAINT budget_categories_pkey PRIMARY KEY (id);


--
-- Name: budget_category_benchmarks budget_category_benchmarks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_category_benchmarks
    ADD CONSTRAINT budget_category_benchmarks_pkey PRIMARY KEY (id);


--
-- Name: budget_items budget_items_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_items
    ADD CONSTRAINT budget_items_pkey PRIMARY KEY (id);


--
-- Name: builder_benchmarks builder_benchmarks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.builder_benchmarks
    ADD CONSTRAINT builder_benchmarks_pkey PRIMARY KEY (id);


--
-- Name: builders builders_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.builders
    ADD CONSTRAINT builders_pkey PRIMARY KEY (id);


--
-- Name: contractors contractors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contractors
    ADD CONSTRAINT contractors_pkey PRIMARY KEY (id);


--
-- Name: document_embeddings document_embeddings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_embeddings
    ADD CONSTRAINT document_embeddings_pkey PRIMARY KEY (id);


--
-- Name: documents documents_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_pkey PRIMARY KEY (id);


--
-- Name: files files_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.files
    ADD CONSTRAINT files_pkey PRIMARY KEY (id);


--
-- Name: files files_storage_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.files
    ADD CONSTRAINT files_storage_key_key UNIQUE (storage_key);


--
-- Name: industry_benchmarks industry_benchmarks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.industry_benchmarks
    ADD CONSTRAINT industry_benchmarks_pkey PRIMARY KEY (id);


--
-- Name: invitations invitations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invitations
    ADD CONSTRAINT invitations_pkey PRIMARY KEY (id);


--
-- Name: invitations invitations_token_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invitations
    ADD CONSTRAINT invitations_token_key UNIQUE (token);


--
-- Name: invoices invoices_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_pkey PRIMARY KEY (id);


--
-- Name: notification_deliveries notification_deliveries_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_pkey PRIMARY KEY (id);


--
-- Name: notification_preferences notification_preferences_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_preferences
    ADD CONSTRAINT notification_preferences_pkey PRIMARY KEY (id);


--
-- Name: notifications notifications_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_pkey PRIMARY KEY (id);


--
-- Name: organization_members organization_members_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organization_members
    ADD CONSTRAINT organization_members_pkey PRIMARY KEY (id);


--
-- Name: organizations organizations_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizations
    ADD CONSTRAINT organizations_pkey PRIMARY KEY (id);


--
-- Name: payments payments_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_pkey PRIMARY KEY (id);


--
-- Name: project_contractors project_contractors_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_contractors
    ADD CONSTRAINT project_contractors_pkey PRIMARY KEY (id);


--
-- Name: project_contractors project_contractors_project_id_contractor_id_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_contractors
    ADD CONSTRAINT project_contractors_project_id_contractor_id_key UNIQUE (project_id, contractor_id);


--
-- Name: project_outcomes project_outcomes_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_outcomes
    ADD CONSTRAINT project_outcomes_pkey PRIMARY KEY (id);


--
-- Name: project_risk_metrics project_risk_metrics_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_risk_metrics
    ADD CONSTRAINT project_risk_metrics_pkey PRIMARY KEY (id);


--
-- Name: projects projects_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.projects
    ADD CONSTRAINT projects_pkey PRIMARY KEY (id);


--
-- Name: refresh_tokens refresh_tokens_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.refresh_tokens
    ADD CONSTRAINT refresh_tokens_pkey PRIMARY KEY (id);


--
-- Name: reminders reminders_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reminders
    ADD CONSTRAINT reminders_pkey PRIMARY KEY (id);


--
-- Name: risk_interventions risk_interventions_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_interventions
    ADD CONSTRAINT risk_interventions_pkey PRIMARY KEY (id);


--
-- Name: schedule_milestones schedule_milestones_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_milestones
    ADD CONSTRAINT schedule_milestones_pkey PRIMARY KEY (id);


--
-- Name: schedule_phases schedule_phases_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_phases
    ADD CONSTRAINT schedule_phases_pkey PRIMARY KEY (id);


--
-- Name: schedule_tasks schedule_tasks_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_tasks
    ADD CONSTRAINT schedule_tasks_pkey PRIMARY KEY (id);


--
-- Name: settings settings_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settings
    ADD CONSTRAINT settings_key_key UNIQUE (key);


--
-- Name: settings settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settings
    ADD CONSTRAINT settings_pkey PRIMARY KEY (id);


--
-- Name: task_dependencies task_dependencies_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_dependencies
    ADD CONSTRAINT task_dependencies_pkey PRIMARY KEY (id);


--
-- Name: task_items task_items_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_items
    ADD CONSTRAINT task_items_pkey PRIMARY KEY (id);


--
-- Name: budget_categories uq_budget_categories_name; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_categories
    ADD CONSTRAINT uq_budget_categories_name UNIQUE (builder_id, name);


--
-- Name: budget_category_benchmarks uq_budget_category_benchmarks; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_category_benchmarks
    ADD CONSTRAINT uq_budget_category_benchmarks UNIQUE (unit_type, category_name);


--
-- Name: builder_benchmarks uq_builder_benchmarks; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.builder_benchmarks
    ADD CONSTRAINT uq_builder_benchmarks UNIQUE (builder_id, unit_type);


--
-- Name: industry_benchmarks uq_industry_benchmarks; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.industry_benchmarks
    ADD CONSTRAINT uq_industry_benchmarks UNIQUE (unit_type, phase_name, metric_type);


--
-- Name: notification_preferences uq_notification_prefs; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_preferences
    ADD CONSTRAINT uq_notification_prefs UNIQUE (user_id, notification_type);


--
-- Name: organization_members uq_org_members_user_org; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organization_members
    ADD CONSTRAINT uq_org_members_user_org UNIQUE (organization_id, user_id);


--
-- Name: project_outcomes uq_project_outcomes; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_outcomes
    ADD CONSTRAINT uq_project_outcomes UNIQUE (project_id);


--
-- Name: project_risk_metrics uq_project_risk_metrics; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_risk_metrics
    ADD CONSTRAINT uq_project_risk_metrics UNIQUE (project_id);


--
-- Name: task_dependencies uq_task_dependencies; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_dependencies
    ADD CONSTRAINT uq_task_dependencies UNIQUE (task_id, depends_on_task_id);


--
-- Name: users users_email_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_email_key UNIQUE (email);


--
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);


--
-- Name: job_i1; Type: INDEX; Schema: pgboss; Owner: -
--

CREATE UNIQUE INDEX job_i1 ON pgboss.job_common USING btree (name, COALESCE(singleton_key, ''::text)) WHERE ((state = 'created'::pgboss.job_state) AND (policy = 'short'::text));


--
-- Name: job_i2; Type: INDEX; Schema: pgboss; Owner: -
--

CREATE UNIQUE INDEX job_i2 ON pgboss.job_common USING btree (name, COALESCE(singleton_key, ''::text)) WHERE ((state = 'active'::pgboss.job_state) AND (policy = 'singleton'::text));


--
-- Name: job_i3; Type: INDEX; Schema: pgboss; Owner: -
--

CREATE UNIQUE INDEX job_i3 ON pgboss.job_common USING btree (name, state, COALESCE(singleton_key, ''::text)) WHERE ((state <= 'active'::pgboss.job_state) AND (policy = 'stately'::text));


--
-- Name: job_i4; Type: INDEX; Schema: pgboss; Owner: -
--

CREATE UNIQUE INDEX job_i4 ON pgboss.job_common USING btree (name, singleton_on, COALESCE(singleton_key, ''::text)) WHERE ((state <> 'cancelled'::pgboss.job_state) AND (singleton_on IS NOT NULL));


--
-- Name: job_i5; Type: INDEX; Schema: pgboss; Owner: -
--

CREATE INDEX job_i5 ON pgboss.job_common USING btree (name, start_after) INCLUDE (priority, created_on, id) WHERE (state < 'active'::pgboss.job_state);


--
-- Name: job_i6; Type: INDEX; Schema: pgboss; Owner: -
--

CREATE UNIQUE INDEX job_i6 ON pgboss.job_common USING btree (name, COALESCE(singleton_key, ''::text)) WHERE ((state <= 'active'::pgboss.job_state) AND (policy = 'exclusive'::text));


--
-- Name: idx_activity_log_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_log_builder_id ON public.activity_log USING btree (builder_id);


--
-- Name: idx_activity_log_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_log_created_at ON public.activity_log USING btree (created_at);


--
-- Name: idx_activity_log_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_log_entity ON public.activity_log USING btree (entity_type, entity_id);


--
-- Name: idx_activity_log_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_log_project_id ON public.activity_log USING btree (project_id);


--
-- Name: idx_activity_log_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_log_user_id ON public.activity_log USING btree (user_id);


--
-- Name: idx_ai_conversations_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_conversations_builder_id ON public.ai_conversations USING btree (builder_id);


--
-- Name: idx_ai_conversations_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_conversations_project_id ON public.ai_conversations USING btree (project_id);


--
-- Name: idx_ai_conversations_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_conversations_user_id ON public.ai_conversations USING btree (user_id);


--
-- Name: idx_ai_feedback_message_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_feedback_message_id ON public.ai_feedback USING btree (message_id);


--
-- Name: idx_ai_insights_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_insights_builder_id ON public.ai_insights USING btree (builder_id);


--
-- Name: idx_ai_insights_is_dismissed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_insights_is_dismissed ON public.ai_insights USING btree (is_dismissed);


--
-- Name: idx_ai_insights_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_insights_project_id ON public.ai_insights USING btree (project_id);


--
-- Name: idx_ai_messages_conversation_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_messages_conversation_id ON public.ai_messages USING btree (conversation_id);


--
-- Name: idx_ai_messages_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_messages_created_at ON public.ai_messages USING btree (created_at);


--
-- Name: idx_ai_patterns_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_patterns_builder_id ON public.ai_patterns USING btree (builder_id);


--
-- Name: idx_ai_patterns_pattern_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_ai_patterns_pattern_type ON public.ai_patterns USING btree (pattern_type);


--
-- Name: idx_alert_thresholds_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alert_thresholds_active ON public.alert_thresholds USING btree (is_active) WHERE (deleted_at IS NULL);


--
-- Name: idx_alert_thresholds_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alert_thresholds_builder_id ON public.alert_thresholds USING btree (builder_id);


--
-- Name: idx_alert_thresholds_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_alert_thresholds_project_id ON public.alert_thresholds USING btree (project_id) WHERE (deleted_at IS NULL);


--
-- Name: idx_budget_categories_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_categories_builder_id ON public.budget_categories USING btree (builder_id);


--
-- Name: idx_budget_categories_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_categories_deleted_at ON public.budget_categories USING btree (deleted_at);


--
-- Name: idx_budget_categories_group_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_categories_group_name ON public.budget_categories USING btree (group_name);


--
-- Name: idx_budget_category_benchmarks_category_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_category_benchmarks_category_name ON public.budget_category_benchmarks USING btree (category_name);


--
-- Name: idx_budget_category_benchmarks_group_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_category_benchmarks_group_name ON public.budget_category_benchmarks USING btree (group_name);


--
-- Name: idx_budget_category_benchmarks_unit_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_category_benchmarks_unit_type ON public.budget_category_benchmarks USING btree (unit_type);


--
-- Name: idx_budget_items_category_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_items_category_id ON public.budget_items USING btree (category_id);


--
-- Name: idx_budget_items_is_purchased; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_items_is_purchased ON public.budget_items USING btree (project_id, is_purchased) WHERE (deleted_at IS NULL);


--
-- Name: idx_budget_items_phase_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_items_phase_id ON public.budget_items USING btree (phase_id);


--
-- Name: idx_budget_items_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_budget_items_project_id ON public.budget_items USING btree (project_id);


--
-- Name: idx_builder_benchmarks_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_builder_benchmarks_builder_id ON public.builder_benchmarks USING btree (builder_id);


--
-- Name: idx_builder_benchmarks_confidence; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_builder_benchmarks_confidence ON public.builder_benchmarks USING btree (confidence_level);


--
-- Name: idx_builder_benchmarks_unit_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_builder_benchmarks_unit_type ON public.builder_benchmarks USING btree (unit_type);


--
-- Name: idx_builders_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_builders_deleted_at ON public.builders USING btree (deleted_at);


--
-- Name: idx_builders_subscription_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_builders_subscription_status ON public.builders USING btree (subscription_status);


--
-- Name: idx_contractors_builder; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contractors_builder ON public.contractors USING btree (builder_id);


--
-- Name: idx_contractors_specialty; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contractors_specialty ON public.contractors USING btree (specialty);


--
-- Name: idx_contractors_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_contractors_status ON public.contractors USING btree (status);


--
-- Name: idx_document_embeddings_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_document_embeddings_deleted_at ON public.document_embeddings USING btree (deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_document_embeddings_document_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_document_embeddings_document_id ON public.document_embeddings USING btree (document_id);


--
-- Name: idx_documents_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_builder_id ON public.documents USING btree (builder_id);


--
-- Name: idx_documents_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_deleted_at ON public.documents USING btree (deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_documents_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_project_id ON public.documents USING btree (project_id);


--
-- Name: idx_documents_tags; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_tags ON public.documents USING gin (tags);


--
-- Name: idx_documents_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_type ON public.documents USING btree (type);


--
-- Name: idx_industry_benchmarks_metric_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_industry_benchmarks_metric_type ON public.industry_benchmarks USING btree (metric_type);


--
-- Name: idx_industry_benchmarks_phase_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_industry_benchmarks_phase_name ON public.industry_benchmarks USING btree (phase_name);


--
-- Name: idx_industry_benchmarks_unit_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_industry_benchmarks_unit_type ON public.industry_benchmarks USING btree (unit_type);


--
-- Name: idx_invitations_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invitations_builder_id ON public.invitations USING btree (builder_id);


--
-- Name: idx_invitations_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invitations_deleted_at ON public.invitations USING btree (deleted_at);


--
-- Name: idx_invitations_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invitations_email ON public.invitations USING btree (email);


--
-- Name: idx_invitations_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invitations_expires_at ON public.invitations USING btree (expires_at);


--
-- Name: idx_invitations_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invitations_token ON public.invitations USING btree (token);


--
-- Name: idx_invoices_budget_item_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_budget_item_id ON public.invoices USING btree (budget_item_id);


--
-- Name: idx_invoices_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_builder_id ON public.invoices USING btree (builder_id);


--
-- Name: idx_invoices_category_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_category_id ON public.invoices USING btree (category_id);


--
-- Name: idx_invoices_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_deleted_at ON public.invoices USING btree (deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_invoices_due_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_due_date ON public.invoices USING btree (due_date);


--
-- Name: idx_invoices_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_project_id ON public.invoices USING btree (project_id);


--
-- Name: idx_invoices_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_status ON public.invoices USING btree (status);


--
-- Name: idx_notification_deliveries_notification_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_deliveries_notification_id ON public.notification_deliveries USING btree (notification_id);


--
-- Name: idx_notification_deliveries_pending; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_deliveries_pending ON public.notification_deliveries USING btree (status) WHERE ((status)::text = 'pending'::text);


--
-- Name: idx_notification_deliveries_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_deliveries_status ON public.notification_deliveries USING btree (status);


--
-- Name: idx_notification_preferences_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notification_preferences_user_id ON public.notification_preferences USING btree (user_id);


--
-- Name: idx_notifications_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_builder_id ON public.notifications USING btree (builder_id);


--
-- Name: idx_notifications_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_created_at ON public.notifications USING btree (created_at DESC);


--
-- Name: idx_notifications_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_is_read ON public.notifications USING btree (is_read);


--
-- Name: idx_notifications_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_type ON public.notifications USING btree (type);


--
-- Name: idx_notifications_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_notifications_user_id ON public.notifications USING btree (user_id);


--
-- Name: idx_org_members_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_members_builder_id ON public.organization_members USING btree (builder_id);


--
-- Name: idx_org_members_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_members_organization_id ON public.organization_members USING btree (organization_id);


--
-- Name: idx_org_members_role; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_members_role ON public.organization_members USING btree (role);


--
-- Name: idx_org_members_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_org_members_user_id ON public.organization_members USING btree (user_id);


--
-- Name: idx_organizations_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_organizations_builder_id ON public.organizations USING btree (builder_id);


--
-- Name: idx_organizations_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_organizations_deleted_at ON public.organizations USING btree (deleted_at);


--
-- Name: idx_payments_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payments_builder_id ON public.payments USING btree (builder_id);


--
-- Name: idx_payments_category_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payments_category_id ON public.payments USING btree (category_id);


--
-- Name: idx_payments_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payments_deleted_at ON public.payments USING btree (deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_payments_invoice_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payments_invoice_id ON public.payments USING btree (invoice_id);


--
-- Name: idx_payments_payment_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payments_payment_date ON public.payments USING btree (payment_date);


--
-- Name: idx_payments_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_payments_project_id ON public.payments USING btree (project_id);


--
-- Name: idx_project_contractors_builder; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_contractors_builder ON public.project_contractors USING btree (builder_id);


--
-- Name: idx_project_contractors_contractor; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_contractors_contractor ON public.project_contractors USING btree (contractor_id);


--
-- Name: idx_project_contractors_project; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_contractors_project ON public.project_contractors USING btree (project_id);


--
-- Name: idx_project_outcomes_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_outcomes_builder_id ON public.project_outcomes USING btree (builder_id);


--
-- Name: idx_project_outcomes_completed_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_outcomes_completed_at ON public.project_outcomes USING btree (completed_at);


--
-- Name: idx_project_outcomes_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_outcomes_project_id ON public.project_outcomes USING btree (project_id);


--
-- Name: idx_project_outcomes_unit_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_outcomes_unit_type ON public.project_outcomes USING btree (unit_type);


--
-- Name: idx_project_risk_metrics_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_risk_metrics_builder_id ON public.project_risk_metrics USING btree (builder_id);


--
-- Name: idx_project_risk_metrics_capital_at_risk; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_risk_metrics_capital_at_risk ON public.project_risk_metrics USING btree (capital_at_risk DESC);


--
-- Name: idx_project_risk_metrics_composite_score; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_risk_metrics_composite_score ON public.project_risk_metrics USING btree (composite_risk_score DESC);


--
-- Name: idx_project_risk_metrics_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_risk_metrics_project_id ON public.project_risk_metrics USING btree (project_id);


--
-- Name: idx_project_risk_metrics_risk_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_project_risk_metrics_risk_level ON public.project_risk_metrics USING btree (risk_level);


--
-- Name: idx_projects_appraisal_document_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_appraisal_document_id ON public.projects USING btree (appraisal_document_id) WHERE (appraisal_document_id IS NOT NULL);


--
-- Name: idx_projects_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_builder_id ON public.projects USING btree (builder_id);


--
-- Name: idx_projects_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_created_at ON public.projects USING btree (created_at);


--
-- Name: idx_projects_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_deleted_at ON public.projects USING btree (deleted_at);


--
-- Name: idx_projects_has_valuation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_has_valuation ON public.projects USING btree (purchase_price) WHERE (purchase_price IS NOT NULL);


--
-- Name: idx_projects_organization_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_organization_id ON public.projects USING btree (organization_id);


--
-- Name: idx_projects_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_projects_status ON public.projects USING btree (status);


--
-- Name: idx_refresh_tokens_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_tokens_builder_id ON public.refresh_tokens USING btree (builder_id);


--
-- Name: idx_refresh_tokens_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_tokens_expires_at ON public.refresh_tokens USING btree (expires_at);


--
-- Name: idx_refresh_tokens_token_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_tokens_token_hash ON public.refresh_tokens USING btree (token_hash);


--
-- Name: idx_refresh_tokens_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_tokens_user_id ON public.refresh_tokens USING btree (user_id);


--
-- Name: idx_reminders_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reminders_builder_id ON public.reminders USING btree (builder_id);


--
-- Name: idx_reminders_is_dismissed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reminders_is_dismissed ON public.reminders USING btree (is_dismissed) WHERE (deleted_at IS NULL);


--
-- Name: idx_reminders_remind_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reminders_remind_at ON public.reminders USING btree (remind_at) WHERE ((deleted_at IS NULL) AND (is_dismissed = false));


--
-- Name: idx_reminders_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reminders_user_id ON public.reminders USING btree (user_id) WHERE (deleted_at IS NULL);


--
-- Name: idx_risk_interventions_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_builder_id ON public.risk_interventions USING btree (builder_id);


--
-- Name: idx_risk_interventions_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_deleted_at ON public.risk_interventions USING btree (deleted_at);


--
-- Name: idx_risk_interventions_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_entity ON public.risk_interventions USING btree (entity_type, entity_id);


--
-- Name: idx_risk_interventions_priority; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_priority ON public.risk_interventions USING btree (priority_rank);


--
-- Name: idx_risk_interventions_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_project_id ON public.risk_interventions USING btree (project_id);


--
-- Name: idx_risk_interventions_severity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_severity ON public.risk_interventions USING btree (severity);


--
-- Name: idx_risk_interventions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_status ON public.risk_interventions USING btree (status);


--
-- Name: idx_risk_interventions_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_risk_interventions_type ON public.risk_interventions USING btree (intervention_type);


--
-- Name: idx_schedule_milestones_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_milestones_project_id ON public.schedule_milestones USING btree (project_id);


--
-- Name: idx_schedule_milestones_target_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_milestones_target_date ON public.schedule_milestones USING btree (target_date);


--
-- Name: idx_schedule_phases_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_phases_builder_id ON public.schedule_phases USING btree (builder_id);


--
-- Name: idx_schedule_phases_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_phases_project_id ON public.schedule_phases USING btree (project_id);


--
-- Name: idx_schedule_tasks_assigned_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_tasks_assigned_to ON public.schedule_tasks USING btree (assigned_to);


--
-- Name: idx_schedule_tasks_phase_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_tasks_phase_id ON public.schedule_tasks USING btree (phase_id);


--
-- Name: idx_schedule_tasks_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_tasks_project_id ON public.schedule_tasks USING btree (project_id);


--
-- Name: idx_schedule_tasks_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_schedule_tasks_status ON public.schedule_tasks USING btree (status);


--
-- Name: idx_task_dependencies_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_dependencies_deleted_at ON public.task_dependencies USING btree (deleted_at) WHERE (deleted_at IS NULL);


--
-- Name: idx_task_dependencies_depends_on; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_dependencies_depends_on ON public.task_dependencies USING btree (depends_on_task_id);


--
-- Name: idx_task_dependencies_task_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_dependencies_task_id ON public.task_dependencies USING btree (task_id);


--
-- Name: idx_task_items_assigned_to; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_items_assigned_to ON public.task_items USING btree (assigned_to) WHERE (deleted_at IS NULL);


--
-- Name: idx_task_items_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_items_builder_id ON public.task_items USING btree (builder_id);


--
-- Name: idx_task_items_due_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_items_due_date ON public.task_items USING btree (due_date) WHERE (deleted_at IS NULL);


--
-- Name: idx_task_items_project_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_items_project_id ON public.task_items USING btree (project_id) WHERE (deleted_at IS NULL);


--
-- Name: idx_task_items_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_task_items_status ON public.task_items USING btree (status) WHERE (deleted_at IS NULL);


--
-- Name: idx_users_builder_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_builder_id ON public.users USING btree (builder_id);


--
-- Name: idx_users_deleted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_deleted_at ON public.users USING btree (deleted_at);


--
-- Name: idx_users_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_email ON public.users USING btree (email);


--
-- Name: idx_users_email_verification_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_email_verification_token ON public.users USING btree (email_verification_token);


--
-- Name: idx_users_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_is_active ON public.users USING btree (is_active);


--
-- Name: idx_users_password_reset_token; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_users_password_reset_token ON public.users USING btree (password_reset_token);


--
-- Name: uq_invitations_org_email_active; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX uq_invitations_org_email_active ON public.invitations USING btree (organization_id, email) WHERE (deleted_at IS NULL);


--
-- Name: job_common_pkey; Type: INDEX ATTACH; Schema: pgboss; Owner: -
--

ALTER INDEX pgboss.job_pkey ATTACH PARTITION pgboss.job_common_pkey;


--
-- Name: budget_category_benchmarks update_budget_category_benchmarks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_budget_category_benchmarks_updated_at BEFORE UPDATE ON public.budget_category_benchmarks FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: builder_benchmarks update_builder_benchmarks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_builder_benchmarks_updated_at BEFORE UPDATE ON public.builder_benchmarks FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: builders update_builders_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_builders_updated_at BEFORE UPDATE ON public.builders FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: industry_benchmarks update_industry_benchmarks_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_industry_benchmarks_updated_at BEFORE UPDATE ON public.industry_benchmarks FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: organization_members update_org_members_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_org_members_updated_at BEFORE UPDATE ON public.organization_members FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: organizations update_organizations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_organizations_updated_at BEFORE UPDATE ON public.organizations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: project_risk_metrics update_project_risk_metrics_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_project_risk_metrics_updated_at BEFORE UPDATE ON public.project_risk_metrics FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: projects update_projects_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_projects_updated_at BEFORE UPDATE ON public.projects FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: risk_interventions update_risk_interventions_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_risk_interventions_updated_at BEFORE UPDATE ON public.risk_interventions FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: users update_users_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON public.users FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: job_common dlq_fkey; Type: FK CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.job_common
    ADD CONSTRAINT dlq_fkey FOREIGN KEY (dead_letter) REFERENCES pgboss.queue(name) ON DELETE RESTRICT DEFERRABLE INITIALLY DEFERRED;


--
-- Name: job_common q_fkey; Type: FK CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.job_common
    ADD CONSTRAINT q_fkey FOREIGN KEY (name) REFERENCES pgboss.queue(name) ON DELETE RESTRICT DEFERRABLE INITIALLY DEFERRED;


--
-- Name: queue queue_dead_letter_fkey; Type: FK CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.queue
    ADD CONSTRAINT queue_dead_letter_fkey FOREIGN KEY (dead_letter) REFERENCES pgboss.queue(name);


--
-- Name: schedule schedule_name_fkey; Type: FK CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.schedule
    ADD CONSTRAINT schedule_name_fkey FOREIGN KEY (name) REFERENCES pgboss.queue(name) ON DELETE CASCADE;


--
-- Name: subscription subscription_name_fkey; Type: FK CONSTRAINT; Schema: pgboss; Owner: -
--

ALTER TABLE ONLY pgboss.subscription
    ADD CONSTRAINT subscription_name_fkey FOREIGN KEY (name) REFERENCES pgboss.queue(name) ON DELETE CASCADE;


--
-- Name: activity_log activity_log_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.activity_log
    ADD CONSTRAINT activity_log_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: activity_log activity_log_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.activity_log
    ADD CONSTRAINT activity_log_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: activity_log activity_log_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.activity_log
    ADD CONSTRAINT activity_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id);


--
-- Name: ai_conversations ai_conversations_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_conversations
    ADD CONSTRAINT ai_conversations_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: ai_conversations ai_conversations_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_conversations
    ADD CONSTRAINT ai_conversations_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: ai_conversations ai_conversations_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_conversations
    ADD CONSTRAINT ai_conversations_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id);


--
-- Name: ai_feedback ai_feedback_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_feedback
    ADD CONSTRAINT ai_feedback_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: ai_feedback ai_feedback_message_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_feedback
    ADD CONSTRAINT ai_feedback_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.ai_messages(id);


--
-- Name: ai_feedback ai_feedback_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_feedback
    ADD CONSTRAINT ai_feedback_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id);


--
-- Name: ai_insights ai_insights_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_insights
    ADD CONSTRAINT ai_insights_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: ai_insights ai_insights_dismissed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_insights
    ADD CONSTRAINT ai_insights_dismissed_by_fkey FOREIGN KEY (dismissed_by) REFERENCES public.users(id);


--
-- Name: ai_insights ai_insights_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_insights
    ADD CONSTRAINT ai_insights_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: ai_messages ai_messages_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_messages
    ADD CONSTRAINT ai_messages_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: ai_messages ai_messages_conversation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_messages
    ADD CONSTRAINT ai_messages_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.ai_conversations(id) ON DELETE CASCADE;


--
-- Name: ai_patterns ai_patterns_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_patterns
    ADD CONSTRAINT ai_patterns_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: ai_patterns ai_patterns_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.ai_patterns
    ADD CONSTRAINT ai_patterns_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.budget_categories(id);


--
-- Name: alert_thresholds alert_thresholds_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.alert_thresholds
    ADD CONSTRAINT alert_thresholds_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: alert_thresholds alert_thresholds_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.alert_thresholds
    ADD CONSTRAINT alert_thresholds_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.budget_categories(id) ON DELETE CASCADE;


--
-- Name: alert_thresholds alert_thresholds_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.alert_thresholds
    ADD CONSTRAINT alert_thresholds_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: budget_categories budget_categories_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_categories
    ADD CONSTRAINT budget_categories_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: budget_items budget_items_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_items
    ADD CONSTRAINT budget_items_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: budget_items budget_items_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_items
    ADD CONSTRAINT budget_items_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.budget_categories(id);


--
-- Name: budget_items budget_items_phase_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_items
    ADD CONSTRAINT budget_items_phase_id_fkey FOREIGN KEY (phase_id) REFERENCES public.schedule_phases(id) ON DELETE SET NULL;


--
-- Name: budget_items budget_items_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.budget_items
    ADD CONSTRAINT budget_items_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: builder_benchmarks builder_benchmarks_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.builder_benchmarks
    ADD CONSTRAINT builder_benchmarks_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: contractors contractors_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.contractors
    ADD CONSTRAINT contractors_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id) ON DELETE CASCADE;


--
-- Name: document_embeddings document_embeddings_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_embeddings
    ADD CONSTRAINT document_embeddings_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: document_embeddings document_embeddings_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.document_embeddings
    ADD CONSTRAINT document_embeddings_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id) ON DELETE CASCADE;


--
-- Name: documents documents_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: documents documents_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: documents documents_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(id);


--
-- Name: invitations invitations_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invitations
    ADD CONSTRAINT invitations_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: invitations invitations_invited_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invitations
    ADD CONSTRAINT invitations_invited_by_fkey FOREIGN KEY (invited_by) REFERENCES public.users(id);


--
-- Name: invitations invitations_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invitations
    ADD CONSTRAINT invitations_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id);


--
-- Name: invoices invoices_budget_item_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_budget_item_id_fkey FOREIGN KEY (budget_item_id) REFERENCES public.budget_items(id);


--
-- Name: invoices invoices_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: invoices invoices_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.budget_categories(id);


--
-- Name: invoices invoices_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id) ON DELETE SET NULL;


--
-- Name: invoices invoices_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: notification_deliveries notification_deliveries_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: notification_deliveries notification_deliveries_notification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_notification_id_fkey FOREIGN KEY (notification_id) REFERENCES public.notifications(id) ON DELETE CASCADE;


--
-- Name: notification_preferences notification_preferences_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_preferences
    ADD CONSTRAINT notification_preferences_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: notification_preferences notification_preferences_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notification_preferences
    ADD CONSTRAINT notification_preferences_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: notifications notifications_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: notifications notifications_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.notifications
    ADD CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: organization_members organization_members_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organization_members
    ADD CONSTRAINT organization_members_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: organization_members organization_members_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organization_members
    ADD CONSTRAINT organization_members_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id) ON DELETE CASCADE;


--
-- Name: organization_members organization_members_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organization_members
    ADD CONSTRAINT organization_members_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: organizations organizations_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.organizations
    ADD CONSTRAINT organizations_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: payments payments_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: payments payments_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.budget_categories(id);


--
-- Name: payments payments_invoice_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES public.invoices(id) ON DELETE SET NULL;


--
-- Name: payments payments_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: project_contractors project_contractors_assigned_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_contractors
    ADD CONSTRAINT project_contractors_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(id);


--
-- Name: project_contractors project_contractors_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_contractors
    ADD CONSTRAINT project_contractors_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id) ON DELETE CASCADE;


--
-- Name: project_contractors project_contractors_contractor_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_contractors
    ADD CONSTRAINT project_contractors_contractor_id_fkey FOREIGN KEY (contractor_id) REFERENCES public.contractors(id) ON DELETE CASCADE;


--
-- Name: project_contractors project_contractors_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_contractors
    ADD CONSTRAINT project_contractors_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: project_outcomes project_outcomes_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_outcomes
    ADD CONSTRAINT project_outcomes_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: project_outcomes project_outcomes_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_outcomes
    ADD CONSTRAINT project_outcomes_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id);


--
-- Name: project_risk_metrics project_risk_metrics_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_risk_metrics
    ADD CONSTRAINT project_risk_metrics_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: project_risk_metrics project_risk_metrics_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.project_risk_metrics
    ADD CONSTRAINT project_risk_metrics_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: projects projects_appraisal_document_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.projects
    ADD CONSTRAINT projects_appraisal_document_id_fkey FOREIGN KEY (appraisal_document_id) REFERENCES public.documents(id) ON DELETE SET NULL;


--
-- Name: projects projects_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.projects
    ADD CONSTRAINT projects_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: projects projects_organization_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.projects
    ADD CONSTRAINT projects_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id);


--
-- Name: refresh_tokens refresh_tokens_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.refresh_tokens
    ADD CONSTRAINT refresh_tokens_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: refresh_tokens refresh_tokens_revoked_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.refresh_tokens
    ADD CONSTRAINT refresh_tokens_revoked_by_fkey FOREIGN KEY (revoked_by) REFERENCES public.users(id);


--
-- Name: refresh_tokens refresh_tokens_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.refresh_tokens
    ADD CONSTRAINT refresh_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: reminders reminders_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reminders
    ADD CONSTRAINT reminders_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: reminders reminders_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reminders
    ADD CONSTRAINT reminders_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: reminders reminders_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reminders
    ADD CONSTRAINT reminders_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- Name: risk_interventions risk_interventions_acknowledged_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_interventions
    ADD CONSTRAINT risk_interventions_acknowledged_by_fkey FOREIGN KEY (acknowledged_by) REFERENCES public.users(id);


--
-- Name: risk_interventions risk_interventions_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_interventions
    ADD CONSTRAINT risk_interventions_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: risk_interventions risk_interventions_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.risk_interventions
    ADD CONSTRAINT risk_interventions_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: schedule_milestones schedule_milestones_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_milestones
    ADD CONSTRAINT schedule_milestones_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: schedule_milestones schedule_milestones_phase_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_milestones
    ADD CONSTRAINT schedule_milestones_phase_id_fkey FOREIGN KEY (phase_id) REFERENCES public.schedule_phases(id) ON DELETE SET NULL;


--
-- Name: schedule_milestones schedule_milestones_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_milestones
    ADD CONSTRAINT schedule_milestones_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: schedule_phases schedule_phases_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_phases
    ADD CONSTRAINT schedule_phases_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: schedule_phases schedule_phases_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_phases
    ADD CONSTRAINT schedule_phases_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: schedule_tasks schedule_tasks_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_tasks
    ADD CONSTRAINT schedule_tasks_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id) ON DELETE SET NULL;


--
-- Name: schedule_tasks schedule_tasks_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_tasks
    ADD CONSTRAINT schedule_tasks_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: schedule_tasks schedule_tasks_phase_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_tasks
    ADD CONSTRAINT schedule_tasks_phase_id_fkey FOREIGN KEY (phase_id) REFERENCES public.schedule_phases(id) ON DELETE CASCADE;


--
-- Name: schedule_tasks schedule_tasks_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.schedule_tasks
    ADD CONSTRAINT schedule_tasks_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: task_dependencies task_dependencies_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_dependencies
    ADD CONSTRAINT task_dependencies_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: task_dependencies task_dependencies_depends_on_task_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_dependencies
    ADD CONSTRAINT task_dependencies_depends_on_task_id_fkey FOREIGN KEY (depends_on_task_id) REFERENCES public.schedule_tasks(id) ON DELETE CASCADE;


--
-- Name: task_dependencies task_dependencies_task_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_dependencies
    ADD CONSTRAINT task_dependencies_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.schedule_tasks(id) ON DELETE CASCADE;


--
-- Name: task_items task_items_assigned_to_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_items
    ADD CONSTRAINT task_items_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id) ON DELETE SET NULL;


--
-- Name: task_items task_items_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_items
    ADD CONSTRAINT task_items_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- Name: task_items task_items_completed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_items
    ADD CONSTRAINT task_items_completed_by_fkey FOREIGN KEY (completed_by) REFERENCES public.users(id);


--
-- Name: task_items task_items_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_items
    ADD CONSTRAINT task_items_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id);


--
-- Name: task_items task_items_project_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_items
    ADD CONSTRAINT task_items_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id) ON DELETE CASCADE;


--
-- Name: task_items task_items_schedule_task_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.task_items
    ADD CONSTRAINT task_items_schedule_task_id_fkey FOREIGN KEY (schedule_task_id) REFERENCES public.schedule_tasks(id) ON DELETE SET NULL;


--
-- Name: users users_builder_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_builder_id_fkey FOREIGN KEY (builder_id) REFERENCES public.builders(id);


--
-- PostgreSQL database dump complete
--

\unrestrict rUCRxK0nmk6tgoHhi6nzvsKy8gXCDX9cm0qFHsgAPFu4v1Urq29oy9kgN5uBKWj

